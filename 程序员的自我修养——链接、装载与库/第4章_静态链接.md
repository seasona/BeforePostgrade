[TOC]
##### 空间与地址分配
链接过程就是将几个输入目标文件加工合并后合成一个输出文件。所以需要将它们的各个段合并到输出文件，一般情况是采用相似段合并的方法，即text段和text段放在一起。步骤是扫描所有的输入目标文件，获得它们的各个段的长度、熟悉和位置，并且将这些文件中的符号表统一放到一个全局符号表中。链接器将获得所有输入目标文件的段长度，并且将它们合并，计算出各个段合并后的长度与位置，并建立映射关系。注意这些空间分配都是虚拟空间。
##### 符号解析与重定位
当源代码被单独编译时，编译器不知道外部符号的地址，所以会暂时用个临时地址代替，并且将这些重定位符号放进重定位表里。重定位的过程中，每个重定位的入口都是对一个符号的引用，那么当链接器需要对某个符号的引用进行重定位时，它就要确定这个符号的目标地址。这时候链接器就会去查找所有输入目标文件的符号表组成的全局符号表。如果找不到就报符号未定义错误。
##### 强符号、弱符号和COMMON块
我们经常的编程中碰到一种情况叫符号重复定义。多个目标文件中含有相同名字全局符号的定义，那么这些目标文件链接的时候会出现符号重复定义的错误。这种符号的定义可以被成为强符号。有些符号的定义可以被成为弱符号。对于C/C++语言来说，编译器默认函数和初始化了的全局变量为强符号，未被初始化的全局变量为弱符号。我们也可以通过gcc编译器的”_attribute_((weak))“，来定义任何一个强符号为弱符号。注意，强符号和弱符号都是针对定义来说的，不是针对符号的引用。比如下面的例子：
```c++
extern int ext;
int weak;
int strong = 1;
_attribute_((weak)) weak2 = 2;
```
上面的程序中，”weak“和”weak2“是弱符号，”strong“和”main“是强符号，而”ext“既不是强符号也不是弱符号，因为它是一个外部变量的引用。针对强弱符号的概念，连接器就会按照如下的规则处理与选择多次定义的全局符号：
1. 不允许强符号被多次定义（既不同的目标文件中不能有同名的强符号）;如果有多个强符号定义，则链接器报符号重复定义错误。
2. 如果一个符号在某个目标文件中是强符号，在其他文件中都是弱符号，那么选择强符号。
3. 如果一个符号在所有目标文件中都为弱符号，那么选择其中占用空间最大的一个。（尽量不要使用多个不同类型的弱符号，否则会造成很难发现的程序错误）。
##### C++相关问题